/**
 * Vanilla ctxm ;) (https://github.com/xylphid)
 * Version 0.1.0
 *
 * @author Anthony PERIQUET
 */
!function(t){var s=null;t.ctxm=function(i,e){return this instanceof t.ctxm?(this.options=t.extend({},t.ctxm.defaults,e),s=this,t(document).on("keydown",function(i){s&&s.opened&&27==i.which&&t.ctxm.close()}),t(document).on("contextmenu, oncontextmenu","*:not(#vanilla-ctxm)",function(){s.opened&&s.close()}),t(document).on("contextmenu",i,function(t){t.preventDefault(),s.elm=t.value,s.event=t,s.open()}),void t(document).on("click","*:not(#vanilla-ctxm)",function(){s.opened&&s.close()})):new t.ctxm(i,e)},t.ctxm.prototype={constructor:t.ctxm,open:function(s){return s instanceof t&&(this.elm=s),this.setOverlay(),this.setMenu(),this.opened=!0,!1},setOverlay:function(){t(".overlay").remove(),this.overlay=t("<div>").addClass("overlay").css("background",this.options.overlay).css("bottom",0).css("display","none").css("height","100%").css("left",0).css("opacity",this.options.opacity).css("position","fixed").css("right",0).css("top",0).css("transition","opacity 100ms, z-index 1s").css("width","100%").css("z-index",1).appendTo("body").fadeIn()},setMenu:function(){this.ctxm=this.ctxm||t("<div>").attr("id","vanilla-ctxm").css("background",this.options.background).css("border-color",this.options.border).css("border-radius","3px").css("border-style","solid").css("border-width","1px").css("font-size",this.options.fontSize).css("padding","5px 0 5px 5px").css("opacity",0).css("position","absolute").css("transition","opacity 200ms, left 1s, top 1s, z-index 200ms").css("width",this.options.width).appendTo("body"),this.ctxm.html(""),t("<div>").addClass("header").html(this.options.headerText).css("border-bottom","solid 1px #000").css("margin-right","5px").css("font-weight","bold").appendTo(this.ctxm),this.setOptions();var s=window.innerWidth-parseInt(this.options.width)>this.event.clientX?this.event.clientX:this.event.clientX-parseInt(this.options.width),i=window.innerHeight-this.ctxm.outerHeight()>this.event.clientY?this.event.clientY:this.event.clientY-this.ctxm.outerHeight();this.ctxm.css("opacity",1).css("left",s+window.scrollX+"px").css("top",i+window.scrollY+"px").css("z-index",2)},setOptions:function(){var s=this.options.items;for(var i in s){var e=t("<div>").addClass("item").css("align-items","center").css("cursor","pointer").css("display","flex").css("flex-direction","row").css("height","20px").on("click",s[i].callback).appendTo("#vanilla-ctxm"),n=/this\./.test(s[i].icon)?this.elm.attr(s[i].icon.replace("this.","")):s[i].icon;t("<div>").addClass("icon-"+n||"noIcon").css("flex","0 20px").css("margin-right","5px").css("order",this.options.iconPosition).appendTo(e),t("<div>").addClass("item").css("flex","1").css("margin-right","5px").css("white-space","nowrap").append(s[i].title).appendTo(e)}},center:function(){this.ctxm.css("left","50%").css("margin-left",-(this.ctxm.outerWidth()/2)+"px").css("margin-top",-(this.ctxm.outerHeight()/2)+"px").css("position","fixed").css("top","50%").css("z-index",this.options.zIndex+1)},close:function(){this.overlay.css("opacity",0).css("z-index",-1),this.ctxm.css("opacity",0).css("z-index",-1),this.opened=!1},getTarget:function(){return this.elm}},t.ctxm.defaults={background:"#FFF",border:"#CDCDCD",fontSize:"14px",headerText:"Context menu",iconPosition:0,opacity:.5,overlay:"#000",width:"200px"},t.ctxm.dispatcher=function(t,i){return s&&"function"==typeof s[i]?(/Event/.test(t)&&t.preventDefault(),s[i](t),s):void 0},t.ctxm.open=function(s){return t.ctxm.dispatcher(s,"open")},t.ctxm.close=function(s){return t.ctxm.dispatcher(s,"close")},t.ctxm.getTarget=function(){return s?s.getTarget():void 0},t.prototype.ctxm=function(i){return this instanceof t&&(s=new t.ctxm(this,i),t.ctxm.open()),this}}(vanilla);